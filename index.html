<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nueva Humanidad</title>
<style>
  body {
    background-color: #E8F5E9; /* Fondo verde pastel */
    font-family: 'Segoe UI', sans-serif;
    max-width: 800px;
    margin: auto;
    padding: 20px;
    color: #4a4a4a;
  }

  .logo {
    display: block;
    margin: 20px auto;
    width: 140px;
  }

  h2 {
    text-align: center;
    color: #3E7C59;
    margin-bottom: 15px;
  }

  label {
    display: block;
    margin-top: 15px;
    font-weight: bold;
    color: #3E7C59;
  }

  input, button, textarea {
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 14px;
  }

  .checkbox-group {
    background: #fff;
    border-radius: 8px;
    padding: 10px;
    margin-top: 8px;
    border: 1px solid #ccc;
  }

  .checkbox-item {
    display: flex;
    align-items: center;
    margin-bottom: 6px;
  }

  .checkbox-group strong {
  display: block;
  margin-top: 10px;
  color: #3E7C59;
  font-size: 14px;
 }

  .checkbox-item input {
    margin-right: 10px;
    width: auto;
  }

  .extra-input {
    display: none;
    margin-top: 8px;
  }

  .warning {
    color: red;
    font-size: 0.85em;
    margin-top: 5px;
    display: none;
  }

  button {
    background-color: #CBA4E6; /* violeta pastel */
    border: none;
    color: white;
    font-weight: bold;
    cursor: pointer;
    margin-top: 20px;
    font-size: 16px;
  }

  button:hover {
    background-color: #B68DDC;
  }

  .suggestions {
    border: 1px solid #ccc;
    background: white;
    position: absolute;
    z-index: 1000;
    width: calc(100% - 22px);
    display: none;
    max-height: 150px;
    overflow-y: auto;
  }

  .suggestion-item {
    padding: 8px;
    cursor: pointer;
  }

  .suggestion-item:hover {
    background-color: #f5f5f5;
  }

  .city-container {
    position: relative;
  }
</style>
</head>
<body>
  <img src="https://amjskrqaoiuabscecmji.supabase.co/storage/v1/object/public/fotocc/UNH_iso.png" alt="Logo Nueva Humanidad" class="logo">
  <h2>Nueva Humanidad</h2>

  <form id="formNH">

    <!-- Datos personales -->
    <label>Nombre:</label>
    <input type="text" name="nombre" required>

    <label>Apellido:</label>
    <input type="text" name="apellido" required>

    <label>Nombre que te gustaría figure:</label>
    <input type="text" name="nombrecc" required>

    <label>Fecha de nacimiento:</label>
    <input type="date" name="fecha_nac" required>

    <label>Hora de nacimiento:</label>
    <input type="time" name="hora_nac" required>

    <!-- Ciudad nacimiento -->
    <label>Ciudad de nacimiento:</label>
    <div class="city-container">
      <input id="ciudad" name="ciudad" type="text" autocomplete="off" required>
      <div id="suggestions-ciudad" class="suggestions"></div>
    </div>
    <label>Provincia:</label>
    <input id="provincia" name="provincia" type="text">
    <label>País:</label>
    <input id="pais" name="pais" type="text">

    <!-- Ciudad residencia -->
    <label>Ciudad de residencia:</label>
    <div class="city-container">
      <input id="ciudad_resi" name="ciudad_resi" type="text" autocomplete="off" required>
      <div id="suggestions-resi" class="suggestions"></div>
    </div>
    <label>Provincia de residencia:</label>
    <input id="provincia_resi" name="provincia_resi" type="text">
    <label>País de residencia:</label>
    <input id="pais_resi" name="pais_resi" type="text">

    <!-- Email y teléfono -->
    <label>Email:</label>
    <input type="email" name="email" required>
    <label>Teléfono:</label>
    <input type="tel" name="telefono">

    <!-- Foto -->
    <label>Foto (JPG/PNG, máx. 1000KB):</label>
    <input type="file" name="foto" accept="image/png, image/jpeg">

    <!-- Formaciones -->
    <label>Estudié o me formé en... (máximo 3)</label>
    <div class="checkbox-group" id="grupoFormacion">
      <div class="checkbox-item"><input type="checkbox" value="Psicología">Psicología</div>
      <div class="checkbox-item"><input type="checkbox" value="Educación">Educación</div>
      <div class="checkbox-item"><input type="checkbox" value="Ciencias Sociales">Ciencias Sociales</div>
      <div class="checkbox-item"><input type="checkbox" value="Salud">Salud</div>
      <div class="checkbox-item"><input type="checkbox" value="Arte">Arte</div>
      <div class="checkbox-item"><input type="checkbox" value="Otro">Otro</div>
    </div>
    <input type="text" id="otroFormacion" class="extra-input" placeholder="Especifica otra formación">
    <p class="warning" id="warnFormacion">Máximo 3 opciones</p>

    <!-- Talentos -->
    <label>Me apasiona... (máximo 3)</label>
    <div class="checkbox-group" id="grupoTalentos">
      <strong>Talentos emocionales</strong>
      <div class="checkbox-item"><input type="checkbox" value="Escuchar profundamente">Escuchar profundamente</div>
      <div class="checkbox-item"><input type="checkbox" value="Cuidar a otros">Cuidar a otros</div>
      <div class="checkbox-item"><input type="checkbox" value="Meditar">Meditar</div>
      <div class="checkbox-item"><input type="checkbox" value=Sostener vínculos">Sostener vínculos</div>
      <div class="checkbox-item"><input type="checkbox" value="Motivar emocionalmente">Motivar emocionalmente</div>
      <div class="checkbox-item"><input type="checkbox" value="Crear espacios de calma">Crear espacios de calma</div>
      <div class="checkbox-item"><input type="checkbox" value="Conectar con lo espiritual">"Conectar con lo espiritual</div>
      <div class="checkbox-item"><input type="checkbox" value="Guiar procesos de sanación emocional">Guiar procesos de sanación emocional</div>
      <div class="checkbox-item"><input type="checkbox" value="Acompañar en procesos difíciles">Acompañar en procesos difíciles</div>
      <div class="checkbox-item"><input type="checkbox" value="Empatizar con facilidad">Empatizar con facilidad</div>
      <div class="checkbox-item"><input type="checkbox" value="Contener en crisis">Contener en crisis</div>
      <div class="checkbox-item"><input type="checkbox" value="Sostener el grupo emocionalmente">Sostener el grupo emocionalmente</div>
      <div class="checkbox-item"><input type="checkbox" value="Transmitir paz">"Transmitir paz</div>
      <div class="checkbox-item"><input type="checkbox" value="Ser canal de inspiración">Ser canal de inspiración</div>
      <div class="checkbox-item"><input type="checkbox" value="Percibir lo que otros sienten">Percibir lo que otros sienten</div>
      <div class="checkbox-item"><input type="checkbox" value="Crear espacios seguros">Crear espacios seguros</div>
      <div class="checkbox-item"><input type="checkbox" value="Contener en crisis">Contener en crisis</div>
      <div class="checkbox-item"><input type="checkbox" value="Abrir el corazón">Abrir el corazón</div>

      <strong>Talentos mentales</strong>strong>
      <div class="checkbox-item"><input type="checkbox" value="Analizar información">Analizar información</div>
      <div class="checkbox-item"><input type="checkbox" value="Organizar procesos">Organizar procesos</div>
      <strong>Talentos físicos</strong>strong>
      <div class="checkbox-item"><input type="checkbox" value="Cocinar con amor">Cocinar con amor</div>
      <div class="checkbox-item"><input type="checkbox" value="Bailar">Bailar</div>
      
      <div class="checkbox-item"><input type="checkbox" value="Otro">Otro</div>
    </div>
    <input type="text" id="otroTalento" class="extra-input" placeholder="Especifica otro talento">
    <p class="warning" id="warnTalentos">Máximo 3 opciones</p>

    <!-- Profesiones -->
    <label>He trabajado como... (máximo 3)</label>
    <div class="checkbox-group" id="grupoProfesiones">
      <div class="checkbox-item"><input type="checkbox" value="Docente">Docente</div>
      <div class="checkbox-item"><input type="checkbox" value="Terapeuta">Terapeuta</div>
      <div class="checkbox-item"><input type="checkbox" value="Comerciante">Comerciante</div>
      <div class="checkbox-item"><input type="checkbox" value="Otro">Otro</div>
    </div>
    <input type="text" id="otraProfesion" class="extra-input" placeholder="Especifica otra profesión">
    <p class="warning" id="warnProfesiones">Máximo 3 opciones</p>

    <!-- Estado -->
    <label>En este momento me siento…</label>
    <div>
      <input type="radio" name="estado" value="Opcion1" required> Transitando el puente hacia la Nueva Humanidad...
      <br><br>
      <input type="radio" name="estado" value="Opcion2" required> Entregad@ a la materialización de la Nueva Humanidad...
    </div>

    <!-- Acceso -->
    <label>Accedí a esta encuesta por:</label>
    <select id="acceso" name="acceso" required>
      <option value="">Selecciona...</option>
      <option value="Instagram">Instagram</option>
      <option value="WhatsApp">WhatsApp</option>
      <option value="Colaborador NH">Colaborador NH</option>
      <option value="Colaborador CC">Colaborador CC</option>
    </select>
    <input type="text" id="nombreColaborador" class="extra-input" placeholder="Nombre del colaborador">

    <!-- Checkbox Política -->
    <div class="checkbox-wrapper">
      <input type="checkbox" id="politica" required>
      <label for="politica">Declaro haber leído y aceptado la Política de Privacidad.</label>
    </div>

    <button type="submit">Enviar</button>
  </form>

  <p id="mensaje-exito" style="color:green; text-align:center; font-weight:bold; display:none;">¡Formulario enviado con éxito!</p>
  <p id="mensaje-error" style="color:red; text-align:center; font-weight:bold; display:none;">Error al enviar. Intenta nuevamente.</p>

<script>
function limitarCheckboxes(grupoId, max, warningId, inputExtraId) {
  const grupo = document.getElementById(grupoId);
  const checkboxes = grupo.querySelectorAll('input[type="checkbox"]');
  const warning = document.getElementById(warningId);
  const inputExtra = document.getElementById(inputExtraId);

  checkboxes.forEach(cb => {
    cb.addEventListener('change', () => {
      const seleccionadas = Array.from(checkboxes).filter(c => c.checked);
      if (seleccionadas.length > max) {
        cb.checked = false;
        warning.style.display = 'block';
        setTimeout(() => warning.style.display = 'none', 2000);
      }
      // Mostrar input "Otro"
      if (cb.value === 'Otro') {
        inputExtra.style.display = cb.checked ? 'block' : 'none';
      }
    });
  });
}

limitarCheckboxes('grupoFormacion', 3, 'warnFormacion', 'otroFormacion');
limitarCheckboxes('grupoTalentos', 3, 'warnTalentos', 'otroTalento');
limitarCheckboxes('grupoProfesiones', 3, 'warnProfesiones', 'otraProfesion');

// Mostrar input para colaborador
document.getElementById('acceso').addEventListener('change', function() {
  const val = this.value;
  document.getElementById('nombreColaborador').style.display = (val.includes('Colaborador')) ? 'block' : 'none';
});

// Autocompletado ciudades
const ciudadesMundo = [
  {ciudad:"Buenos Aires",provincia:"CABA",pais:"Argentina",lat:-34.6118,lon:-58.3960},
  {ciudad:"Córdoba",provincia:"Córdoba",pais:"Argentina",lat:-31.4201,lon:-64.1888},
  {ciudad:"Rosario",provincia:"Santa Fe",pais:"Argentina",lat:-32.9442,lon:-60.6505}
  // Puedes añadir más...
];

function setupCityAutocomplete(inputId, suggestionsId, provId, paisId, latId, lonId) {
  const input = document.getElementById(inputId);
  const suggestionsDiv = document.getElementById(suggestionsId);

  input.addEventListener('input', function() {
    const query = this.value.toLowerCase();
    if (query.length < 2) { suggestionsDiv.style.display = 'none'; return; }
    const results = ciudadesMundo.filter(c => c.ciudad.toLowerCase().includes(query) || c.provincia.toLowerCase().includes(query));
    suggestionsDiv.innerHTML = '';
    results.forEach(city => {
      const item = document.createElement('div');
      item.className = 'suggestion-item';
      item.textContent = `${city.ciudad}, ${city.provincia}, ${city.pais}`;
      item.onclick = () => {
        input.value = city.ciudad;
        document.getElementById(provId).value = city.provincia;
        document.getElementById(paisId).value = city.pais;
        document.getElementById(latId).value = city.lat;
        document.getElementById(lonId).value = city.lon;
        suggestionsDiv.style.display = 'none';
      };
      suggestionsDiv.appendChild(item);
    });
    suggestionsDiv.style.display = results.length ? 'block' : 'none';
  });
}

setupCityAutocomplete("ciudad","suggestions-ciudad","provincia","pais","lat","lon");
setupCityAutocomplete("ciudad_resi","suggestions-resi","provincia_resi","pais_resi","lat_resi","lon_resi");

// Envío a Make
document.getElementById('formNH').addEventListener('submit', async function(e) {
  e.preventDefault();

  // Recoger valores
  const getGrupo = (id) => {
    const seleccionadas = Array.from(document.querySelectorAll(`#${id} input[type="checkbox"]:checked`)).map(cb => cb.value);
    return seleccionadas.join(', ');
  };

  const data = {
    nombre: this.nombre.value,
    apellido: this.apellido.value,
    nombrecc: this.nombrecc.value,
    fecha_nac: this.fecha_nac.value,
    hora_nac: this.hora_nac.value,
    ciudad: this.ciudad.value,
    provincia: this.provincia.value,
    pais: this.pais.value,
    ciudad_resi: this.ciudad_resi.value,
    provincia_resi: this.provincia_resi.value,
    pais_resi: this.pais_resi.value,
    email: this.email.value,
    telefono: this.telefono.value,
    formacion: getGrupo('grupoFormacion') + (document.getElementById('otroFormacion').value ? ', ' + document.getElementById('otroFormacion').value : ''),
    talentos: getGrupo('grupoTalentos') + (document.getElementById('otroTalento').value ? ', ' + document.getElementById('otroTalento').value : ''),
    profesiones: getGrupo('grupoProfesiones') + (document.getElementById('otraProfesion').value ? ', ' + document.getElementById('otraProfesion').value : ''),
    estado: document.querySelector('input[name="estado"]:checked').value,
    acceso: this.acceso.value,
    colaborador: document.getElementById('nombreColaborador').value
  };

  try {
    const res = await fetch("https://hook.us2.make.com/6gjdmhgnwe3xb8xwabs2pflfv5qo40wj", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(data)
    });
    if(res.ok){
      document.getElementById('mensaje-exito').style.display = 'block';
      this.reset();
    } else {
      document.getElementById('mensaje-error').style.display = 'block';
    }
  } catch {
    document.getElementById('mensaje-error').style.display = 'block';
  }
});
</script>
</body>
</html>
